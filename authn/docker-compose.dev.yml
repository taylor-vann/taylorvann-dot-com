# brian taylor vann
# taylorvann dot com

version: "3"
services:
  webapi:
    container_name: authn_webapi
    depends_on:
      - authn_store_db
      - authn_infra_cache
      - authn_store_cache
      - authn_whitelist_cache
    build:
      context: ./webapi/
      dockerfile: dockerfile
    restart: always
    env_file:
      - ./environment_variables.env
    ports:
      - "3000:80"
    extra_hosts:
      - "authn.briantaylorvann.com:10.88.0.1"
      - "logs.briantaylorvann.com:10.88.0.1"
    volumes:
      - ./webapi/:/go/src/webapi/
    command: "go run /go/src/webapi/main.go"
  store_db:
    container_name: authn_store_db
    build:
      context: ./store_db/
      dockerfile: dockerfile.dev
    restart: always
    env_file:
      - ./environment_variables.env
    volumes:
      - ./store_db/postgres_data/:/var/lib/postgresql/data/
    command: "-p 5100"
  infra_cache:
    container_name: authn_infra_cache
    build:
      context: ./infra_cache/
      dockerfile: dockerfile.dev
    restart: always
    volumes:
      - ./infra_cache/redis_data/:/data
  store_cache:
    container_name: authn_store_cache
    build:
      context: ./store_cache/
      dockerfile: dockerfile.dev
    restart: always
    volumes:
      - ./store_cache/redis_data/:/data
  whitelist_cache:
    container_name: authn_whitelist_cache
    build:
      context: ./whitelist_cache/
      dockerfile: dockerfile.dev
    restart: always
    volumes:
      - ./whitelist_cache/redis_data/:/data